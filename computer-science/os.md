# Операционная система

## Роли
1. ОС выполнеяет следующие роли:
    * Memory management
    * Scheduling - планирование (выполнение нескольких программа параллельно)
    * IPC (межпроцессорное взаимодействие)

## Виды памяти
1. Автоматическая - стэк
1. Статическая - встраивается в приложение. Секции `.bss` и `.data` в ассемблере.
1. Динамическая - куча

## Выделение памяти
1. При выделение памяти в начале участка (или в некоторых ситуациях перед началом участка памяти) сохраняется структура MCB (memory control block). Т.е. указатель на следующий блок выделенной памяти.
    ```c
    struct MCB {
        size_t offset;
        size_t size;
        MCB * next;
    };
    ```
1. ОС при загрузке проставляет корневой MCB, при каждом последующем выделении она добавляет новый MCB в цепочку.
1. Для того чтобы понять не занят ли участок нужно пробежаться по всем `MCB`
1. Для очистки участка памяти достаточно просто переставить указатель `MCB * next`

## Планировщик
1. В железе существует таймер, который генерирует прерывание каждый такт времени.
1. В обработчик прерывания таймера мы можем вставить свой пользовательский код, к примеру считать координаты мышки и передвинуть курсор.
1. Планировщик выполняется по прерыванию таймера и делает следующее:
    * Снимает процесс с выполнения (копирует все его регистры)
    * Выбирает следующий процесс на выполнение, выбирает какой поток нужно поставить на выполнение
    * Ставит процесс на выполнение (копирует регистры процесса в процессор)
1. Процесс владеет следующими ресурсами
    1. Адрессное пространство (память)
    1. Потоки
    1. Системные объекты (открытые файлы, семафоры)
1. Поток - это цепочка команд выполняемая в памяти процессора

